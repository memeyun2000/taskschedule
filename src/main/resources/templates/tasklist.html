<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Getting Started: Serving Web Content</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link th:href="@{bootstrap/css/bootstrap.min.css}" rel="stylesheet" />

    <script th:src="@{jquery/jquery-3.2.1.min.js}"></script>
    <script th:src="@{bootstrap/js/bootstrap.min.js}"></script>

    <script th:src="@{common/common-page.js}"></script>
    <script th:src="@{js/utils/DateUtil.js}"></script>
    <script th:src="@{js/tasklist.js}"></script>

</head>

<body>
    <form action="#" id="form1" th:action="@{/updateTaskStatus}" method="post">
        <div class="container-fluid">
            <ol class="breadcrumb">
                <li>
                    <a href="#">Home</a>
                </li>
                <li class="active">
                    <a href="taskSparkJobInfo">任务监控</a>
                </li>
                <li>
                  <a href="#">spark任务参数</a>
                </li>
            </ol>
            <h1>
                <span>任务监控</span>
            </h1>
            <div class="row">
                <div class="col-xs-6">

                </div>
                <div class="col-xs-6">
                    <ul class="nav nav-pills pull-right">
                        <li>
                            <a href="#" class="changeStatDt" data-miner-num="1" data-miner-unit="D">近1天</a>
                        </li>
                        <li>
                            <a href="#" class="changeStatDt" data-miner-num="1" data-miner-unit="M">近1月</a>
                        </li>
                        <li>
                            <a href="#" class="changeStatDt" data-miner-num="3" data-miner-unit="M">近3月</a>
                        </li>
                        <li>
                            <a href="#" class="changeStatDt" data-miner-num="1" data-miner-unit="Y">近1年</a>
                        </li>
                    </ul>
                </div>

            </div>
            <div class="row">
              <div class="" th:object="${taskFactModel}">
                <div class="row"  >
                  <div class="col-xs-1">
                    任务日期:
                  </div>
                  <div class="col-xs-3">
                    <div class="col-xs-5">
                      <input type="text" class="form-control" name="statDtBegin" th:value="*{statDtBegin}" />
                    </div>
                    <div class="col-xs-2">
                      至
                    </div>
                    <div class="col-xs-5">
                      <input type="text" class="form-control" name="statDtEnd" th:value="*{statDtEnd}" />
                    </div>
                  </div>
                  <div class="col-xs-1">
                    任务类型：
                  </div>
                  <div class="col-xs-3">
                    <input type="text" class="form-control" name="taskType" th:value="*{taskType}" />
                  </div>
                  <div class="col-xs-1">
                    任务粒度：
                  </div>
                  <div class="col-xs-3">
                    <input type="text" class="form-control" name="granularity" th:value="*{granularity}" />
                  </div>


                </div>
                <div class="row">
                  <div class="col-xs-1">
                    任务id：
                  </div>
                  <div class="col-xs-3">
                    <input type="text" class="form-control" name="id.taskId" th:value="*{id.taskId}" />
                  </div>
                  <div class="col-xs-1">
                    任务状态：
                  </div>
                  <div class="col-xs-3">
                    <input type="text" class="form-control" name="status" th:value="*{status}" />
                  </div>
                  <div class="col-xs-1">

                  </div>
                  <div class="col-xs-3">

                  </div>
                </div>
              </div>

            </div>
            <div class="row">
                <div class="col-xs-6">
                    <!-- 分页 -->
                    <div th:include="fragment_page :: pagination"></div>
                </div>
                <div class="col-xs-6">
                    <!-- <div class="pull-right btn-group" style="margin-top:30px">
                    <button type="button" class="btn btn-default" onclick="setstate()"></button>
                    <input type="text" name="submitStatus" value="2" /> -->
                    <div class="input-group pull-right col-xs-2" style="margin:30px">
                        <span class="input-group-btn">
                            <button class="btn btn-danger" onclick="setstate()" type="button">重新计算</button>
                        </span>
                        <input type="text" name="submitStatus" value="2" class="form-control" />
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- 数据 -->
                <table class="table table-bordered table-striped">
                    <thead>
                        <th>
                            <span>
                                <a href="#" onclick="selectAll()">全选</a> &nbsp;
                                <a href="#" onclick="unselectAll()">取消</a>
                            </span>
                        </th>
                        <th>数据日期</th>
                        <th>任务id</th>
                        <th>任务类型</th>
                        <th>计算开始时间</th>
                        <th>计算结束时间</th>
                        <th>允许计算时间</th>
                        <th>创建时间</th>
                        <th>任务状态</th>
                    </thead>
                    <tbody>
                        <tr th:each="task,taskstat:${page}">
                            <td>
                                <input type="checkbox" name="checkboxid" class="checkboxid" th:value="${task.id.taskId}" />
                                <input type="hidden" name="checkboxstatdt" th:value="${task.id.statDt}" />
                                <!-- <input type="hidden" name="id" th:value="${task.id}" /> -->
                            </td>
                            <td>
                                <span th:text="${task.id.statDt}"></span>
                            </td>
                            <td>
                                <span th:text="${task.id.taskId}"></span>
                            </td>
                            <td>
                                <span th:text="${task.taskType}"></span>
                            </td>
                            <td>
                                <span th:text="${task.calBeginTime}"></span>
                            </td>
                            <td>
                                <span th:text="${task.calEndTime}"></span>
                            </td>
                            <td>
                                <span th:text="${task.allowCalTime}"></span>
                            </td>
                            <td>
                                <span th:text="${task.createtime}"></span>
                            </td>
                            <td>
                                <span th:text="${task.status}"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </form>
    <script th:inline="javascript" type="text/javascript">
        document.onkeydown = function (e) {
            if (!e) {
                e = windows.event;
            }
            if ((e.keyCode || e.which) == 13) {
                search();
            }
        }

        function search() {
            document.getElementById("form1").action = "/tasklist";
            document.getElementById("form1").submit();
        }

        function setstate() {
            document.getElementById("form1").action = "/updateTaskStatus";
            document.getElementById("form1").submit();
        }

        function selectAll() {
            var checkboxObjs = document.getElementsByName("checkboxid");
            /*<![CDATA[*/
            for (var i = 0; i < checkboxObjs.length; i++) { /*]]>*/
                checkboxObjs[i].checked = true;
            }
        }

        function unselectAll() {
            var checkboxObjs = document.getElementsByName("checkboxid");
            /*<![CDATA[*/
            for (var i = 0; i < checkboxObjs.length; i++) { /*]]>*/
                checkboxObjs[i].checked = false;
            }
        }
    </script>
</body>

</html>
